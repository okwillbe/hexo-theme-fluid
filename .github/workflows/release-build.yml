# 文件名：release-build.yml
name: Build Release Packages

on:
  release:
    types: [created]

jobs:
  build-multi-platform:
    strategy:
      matrix:
        os: [ubuntu-latest]
        include:
          - os: ubuntu-latest
            asset_name: app-linux
            ext: .tar.gz
    
    runs-on: ${{ matrix.os }}
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Build
        run: npm run build
        
      - name: Package
        run: |
          # 根据不同平台打包
          mkdir -p release
          cp -r dist/* release/
          
          if [ "${{ matrix.os }}" == "windows-latest" ]; then
            7z a ${{ matrix.asset_name }}-${{ github.ref_name }}${{ matrix.ext }} ./release/*
          else
            tar -czf ${{ matrix.asset_name }}-${{ github.ref_name }}${{ matrix.ext }} -C release .
          fi
      
      - name: Upload artifact
        uses: actions/upload-artifact@v3
        with:
          name: ${{ matrix.asset_name }}
          path: ${{ matrix.asset_name }}-${{ github.ref_name }}${{ matrix.ext }}
