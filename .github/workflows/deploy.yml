# 工作流名称：Hexo部署
name: Deploy Hexo

# 触发条件：当有代码推送到仓库时触发（任何分支的任何push操作）
on: [push]

# 定义作业
jobs:
  # 作业名称：deploy（部署）
  deploy:
    # 指定运行环境：使用最新的Ubuntu系统作为GitHub Actions的Runner
    runs-on: ubuntu-latest
    
    # 步骤定义
    steps:
      # 步骤1：执行部署脚本
      - name: Execute deploy script
        # 使用第三方SSH Action，用于通过SSH连接到远程服务器并执行命令
        uses: appleboy/ssh-action@v1.0.0
        # 配置参数
        with:
          # 服务器主机地址（IP或域名），从GitHub仓库的Secrets中获取
          # Secrets是GitHub中存储敏感信息的加密环境变量
          host: ${{ secrets.HEXO_HOST }}
          
          # SSH登录用户名：使用之前创建的受限用户'github-hexo'
          # 这个用户只能执行特定的Hexo部署脚本
          username: ${{ secrets.HEXO_GITHUB }}
          
          # SSH私钥，从GitHub Secrets中获取
          # 对应'github-hexo'用户的公钥需要提前添加到服务器的authorized_keys中
          key: ${{ secrets.HEXO_SSH_KEY }}
          
          # 要在远程服务器上执行的脚本命令：
          # 使用sudo以hexo用户身份执行部署脚本
          # 具体路径：/home/hexo/hexo/deploy-scripts/deploy.sh
          script: "sudo -u hexo /home/hexo/hexo/deploy-scripts/deploy.sh"
